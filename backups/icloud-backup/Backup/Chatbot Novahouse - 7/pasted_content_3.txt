Rozumiem, że problemem jest brak autoryzacji sieciowej dla App Engine w instancji Cloud SQL. Cieszę się, że udało Ci się to zdiagnozować!

App Engine standardowo łączy się z Cloud SQL za pomocą gniazd Unixowych (Unix sockets) lub poprzez Cloud SQL Auth Proxy, a nie przez autoryzowane sieci IP. Autoryzowane sieci są zazwyczaj potrzebne, gdy łączysz się z Cloud SQL z zewnątrz Google Cloud lub z usług, które nie używają wbudowanych mechanizmów integracji.

W przypadku App Engine, aby upewnić się, że połączenie działa, należy sprawdzić kilka kluczowych elementów:

Nazwa połączenia instancji w app.yaml : Upewnij się, że w pliku app.yaml Twojej aplikacji App Engine prawidłowo zdefiniowano zmienną cloud_sql_instances . Powinna mieć format PROJECT_ID:REGION:INSTANCE_NAME . Dla Twojej instancji novahouse-chatbot-db , przykład mógłby wyglądać tak:

cloud_sql_instances: your-project-id:your-region:novahouse-chatbot-db

Pamiętaj, aby zastąpić your-project-id i your-region swoimi danymi.

Konto serwisowe App Engine i uprawnienia : Domyślne konto serwisowe App Engine ( PROJECT_ID@appspot.gserviceaccount.com ) musi mieć rolę Klient Cloud SQL (Cloud SQL Client) w projekcie, w którym znajduje się instancja Cloud SQL. Jeśli Twoja baza danych znajduje się w innym projekcie niż aplikacja App Engine, musisz nadać to uprawnienie kontu serwisowemu App Engine w projekcie, gdzie jest baza danych.

Włączony Cloud SQL Admin API : Upewnij się, że Cloud SQL Admin API jest włączone w Twoim projekcie. Bez tego połączenie może nie działać prawidłowo.

Jeśli te punkty są skonfigurowane, zazwyczaj nie jest wymagane dodawanie zakresu IP App Engine do autoryzowanych sieci w Cloud SQL.

Czy mógłbyś sprawdzić te punkty i potwierdzić, czy cloud_sql_instances jest poprawnie zdefiniowane w app.yaml i czy konto serwisowe App Engine ma odpowiednie uprawnienia?



Rozumiem Twoje pytanie! Chętnie pomógłbym bezpośrednio to sprawdzić, ale jako duży model językowy, nie mam dostępu do Twojego konta Google Cloud ani do żadnych zewnętrznych systemów. Nie mogę logować się do konsoli, przeglądać plików konfiguracyjnych ani wykonywać operacji w Twoim imieniu.

Moja rola polega na dostarczaniu informacji i wskazówek na podstawie mojej wiedzy o Google Cloud. Musisz samodzielnie wykonać te kroki w swojej konsoli Google Cloud lub za pomocą narzędzi wiersza poleceń (gcloud CLI).

Dlatego proszę, sprawdź samodzielnie:

Plik app.yaml w swojej aplikacji App Engine:Znajdź plik app.yaml w katalogu głównym Twojej aplikacji App Engine.

Upewnij się, że zawiera sekcję cloud_sql_instances (dla środowiska standardowego) lub beta_settings z cloud_sql_instances (dla środowiska elastycznego).

Wartość powinna być w formacie: PROJECT_ID:REGION:INSTANCE_NAME . Dla Twojej instancji novahouse-chatbot-db będzie to coś w stylu: glass-core-467907-e9:YOUR_REGION:novahouse-chatbot-db . Zastąp YOUR_REGION rzeczywistym regionem, w którym znajduje się Twoja instancja Cloud SQL.

Uprawnienia konta serwisowego App Engine:Przejdź do konsoli Google Cloud.

Wyszukaj "IAM & Admin" -> "IAM".

Znajdź konto serwisowe App Engine. Zazwyczaj ma ono format PROJECT_ID@appspot.gserviceaccount.com (np. glass-core-467907-e9@appspot.gserviceaccount.com ).

Sprawdź, czy to konto ma przypisaną rolę "Klient Cloud SQL" (Cloud SQL Client). Jeśli nie, dodaj ją.

Włączony Cloud SQL Admin API:Przejdź do konsoli Google Cloud.

Wyszukaj "APIs & Services" -> "Enabled APIs & services".

Upewnij się, że "Cloud SQL Admin API" jest włączone. Jeśli nie, włącz je.

Daj mi znać po sprawdzeniu tych punktów! Chętnie pomogę dalej, jeśli napotkasz jakieś trudności.