openapi: 3.0.3
info:
  title: NovaHouse Chatbot API
  description: |
    Enterprise-grade REST API for NovaHouse interior finishing services chatbot.

    ## Features
    - ü§ñ AI-powered chatbot with 45+ FAQ
    - üìä Analytics & A/B testing
    - üéØ Lead management
    - üìÖ Booksy integration
    - üîç Full-text search
    - üîí GDPR/RODO compliant

    ## Authentication
    Most endpoints require API key authentication via `X-API-Key` header.

    ## Rate Limiting
    - 100 requests per minute per IP
    - 1000 requests per hour per IP

    ## Support
    - Email: support@novahouse.pl
    - GitHub: https://github.com/MrCanon19/novahouse-chatbot-api
  version: 2.3.1
  contact:
    name: NovaHouse Support
    email: support@novahouse.pl
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://glass-core-467907-e9.ey.r.appspot.com
    description: Production server
  - url: http://localhost:5000
    description: Local development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Chatbot
    description: AI chatbot conversations
  - name: Knowledge Base
    description: Search and browse knowledge base
  - name: Leads
    description: Lead management
  - name: Analytics
    description: Analytics and metrics
  - name: Booking
    description: Booksy integration
  - name: Admin
    description: Administrative endpoints

security:
  - ApiKeyAuth: []

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        timestamp:
          type: string
          format: date-time
        version:
          type: string
          example: 2.3.1
        environment:
          type: string
          example: production

    ChatMessage:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: User message
          example: "Jakie sƒÖ ceny projekt√≥w?"
        session_id:
          type: string
          description: Session identifier
          example: "user-123-session"
        language:
          type: string
          description: Language code (pl/en)
          default: pl
          example: pl

    ChatResponse:
      type: object
      properties:
        response:
          type: string
          description: Bot response
        session_id:
          type: string
        confidence:
          type: number
          format: float
        intent:
          type: string
        entities:
          type: array
          items:
            type: object

    Lead:
      type: object
      required:
        - name
        - email
        - phone
      properties:
        id:
          type: integer
          readOnly: true
        name:
          type: string
          example: "Jan Kowalski"
        email:
          type: string
          format: email
          example: "jan.kowalski@example.com"
        phone:
          type: string
          example: "+48123456789"
        source:
          type: string
          example: "chatbot"
        message:
          type: string
        status:
          type: string
          enum: [new, contacted, qualified, converted, closed]
        created_at:
          type: string
          format: date-time
          readOnly: true

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        status:
          type: integer

paths:
  /api/health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check API health status
      operationId: getHealth
      security: []
      responses:
        "200":
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /api/chatbot/message:
    post:
      tags:
        - Chatbot
      summary: Send message to chatbot
      description: Send a message and get AI-powered response
      operationId: sendMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessage"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatResponse"
        "400":
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "429":
          description: Rate limit exceeded

  /api/knowledge/search:
    get:
      tags:
        - Knowledge Base
      summary: Search knowledge base
      description: Full-text search across knowledge base
      operationId: searchKnowledge
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: "projekt"
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Maximum results
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      type: object
                  total:
                    type: integer
        "400":
          description: Invalid query

  /api/leads:
    get:
      tags:
        - Leads
      summary: List leads
      description: Get paginated list of leads
      operationId: getLeads
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: status
          in: query
          schema:
            type: string
            enum: [new, contacted, qualified, converted, closed]
      responses:
        "200":
          description: List of leads
          content:
            application/json:
              schema:
                type: object
                properties:
                  leads:
                    type: array
                    items:
                      $ref: "#/components/schemas/Lead"
                  total:
                    type: integer
                  page:
                    type: integer
                  per_page:
                    type: integer
        "401":
          description: Unauthorized

    post:
      tags:
        - Leads
      summary: Create lead
      description: Create a new lead
      operationId: createLead
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lead"
      responses:
        "201":
          description: Lead created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Lead"
        "400":
          description: Invalid input
        "401":
          description: Unauthorized

  /api/analytics/summary:
    get:
      tags:
        - Analytics
      summary: Get analytics summary
      description: Get overview of key metrics
      operationId: getAnalyticsSummary
      responses:
        "200":
          description: Analytics summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_conversations:
                    type: integer
                  total_leads:
                    type: integer
                  conversion_rate:
                    type: number
                    format: float
                  avg_response_time:
                    type: number
                    format: float
        "401":
          description: Unauthorized

  /api/backup/manual:
    post:
      tags:
        - Admin
      summary: Create manual backup
      description: Trigger manual database backup
      operationId: createBackup
      responses:
        "200":
          description: Backup created
        "401":
          description: Unauthorized
        "500":
          description: Backup failed
